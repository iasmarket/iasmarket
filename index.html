<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IaSmarKet.us</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Arial', sans-serif;
            background: #131421;
        }
        header {
            background: linear-gradient(120deg, #ff316a 0%, #27e3c2 100%);
            color: #fff;
            padding: 48px 0 38px 0;
            text-align: center;
            box-shadow: 0 2px 24px #0007;
            position: relative;
            background-size: 400% 400%;
            animation: gradientMove 8s ease infinite;
            display: flex;
            align-items: center;
            justify-content: flex-start;
        }
        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .logo {
            margin-left: 20px;
            width: 90px;
            height: auto;
            position: static;
        }
        .header-content {
            margin-left: 32px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .logo-title {
            font-size: 2.8em;
            font-weight: 900;
            letter-spacing: 2px;
            margin-bottom: 10px;
            text-shadow: 0 4px 18px #0007, 0 1px 0 #fff5;
            filter: drop-shadow(0 6px 16px #ff316a65);
            text-align: left;
        }
        .subtitle {
            font-size: 1.3em;
            font-weight: 500;
            margin-top: 11px;
            color: #fffde7;
            text-shadow: 0 2px 6px #0008;
            animation: popin 1.1s cubic-bezier(.68,-0.55,.27,1.55);
            text-align: left;
        }
        @keyframes popin {
            0% { opacity: 0; transform: translateY(-16px) scale(0.8);}
            100% { opacity: 1; transform: translateY(0) scale(1);}
        }
        h1 {
            text-align: center;
            color: #ff316a;
            font-size: 2.1em;
            margin-top: 38px;
            letter-spacing: 1px;
            text-shadow: 0 2px 10px #0006;
        }
        main {
            min-height: 100vh;
            padding-bottom: 40px;
            background: 
                linear-gradient(120deg, #181c22cc 40%, #1b2231dd 100%),
                url('bgrnd.png');
            background-repeat: repeat;
            background-size: auto, auto;
            display: flex;
        }
        /* Sidebar menu styles */
        .sidebar {
            width: 265px;
            min-width: 210px;
            background: linear-gradient(135deg, #181c22 75%, #1b2231 100%);
            border-top-right-radius: 30px;
            border-bottom-right-radius: 30px;
            box-shadow: 2px 0 18px #0007;
            padding: 36px 0 36px 0;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            position: sticky;
            top: 0;
            height: 90vh;
            margin: 35px 0 35px 0;
            z-index: 2;
        }
        .sidebar-title {
            font-size: 1.25em;
            color: #fff;
            font-weight: 700;
            letter-spacing: 1px;
            padding: 0 26px 18px 38px;
            margin-bottom: 0;
            border-bottom: 1.5px solid #25273955;
            text-shadow: 0 2px 9px #27e3c288;
        }
        .category-list {
            list-style: none;
            padding: 0;
            margin: 0;
            flex: 1;
            overflow-y: auto;
        }
        .category-item {
            margin: 0;
        }
        .category-link {
            display: block;
            padding: 13px 36px 13px 38px;
            color: #eaeaea;
            text-decoration: none;
            font-size: 1.08em;
            border-left: 4px solid transparent;
            transition: 
                background 0.16s, 
                color 0.16s, 
                border-color 0.18s, 
                box-shadow 0.18s;
            border-radius: 0 15px 15px 0;
            margin-bottom: 2px;
            font-weight: 500;
            position: relative;
        }
        .category-link:hover,
        .category-link.active {
            background: linear-gradient(90deg,#27e3c220 0%,#ff316a11 100%);
            color: #ff316a;
            border-left: 4px solid #ff316a;
            box-shadow: 2px 0 16px #ff316a19;
            text-shadow: 0 2px 8px #ff316a44;
        }
        /* Main content wrapper */
        .main-content {
            flex: 1;
            padding-left: 0;
            width: 100%;
        }
        .main-content-inner {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
        }
        .repo-section {
            margin: 56px auto 0 auto;
            max-width: 1200px;
            padding: 0 24px 36px 24px;
            border-bottom: 2px solid #25273955;
        }
        .repo-title {
            font-size: 2em;
            font-weight: 700;
            color: #f4fcfb;
            text-align: center;
            display: block;
            margin-bottom: 28px;
            text-decoration: none;
            transition: color 0.2s, text-shadow 0.2s;
            letter-spacing: 1px;
            text-shadow: 0 1px 8px #ff316a44;
        }
        .repo-title:hover {
            color: #ff316a;
            text-shadow: 0 1px 16px #ff316ad0;
        }
        /* Responsive, variable number of products per row */
        .products {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 32px;
            justify-content: center;
            align-items: stretch;
        }
        .product {
            background: linear-gradient(135deg, #232538ef 70%, #1a1c23f7 100%);
            border: 1.5px solid #252739;
            border-radius: 18px;
            width: 330px;
            max-width: 97vw;
            padding: 22px 15px 20px 15px;
            margin: 10px 0;
            text-align: center;
            box-shadow: 0 4px 32px #0007, 0 1.5px 8px #ff316a15;
            transition: transform 0.22s, box-shadow 0.22s;
            position: relative;
            overflow: hidden;
        }
        .product:hover {
            transform: scale(1.04);
            box-shadow: 0 10px 48px #ff316a3c, 0 8px 32px #000c;
            z-index: 2;
        }
        .product img {
            width: 100%;
            height: 205px;
            object-fit: cover;
            border-radius: 10px;
            box-shadow: 0 2px 12px #ff316a22;
            transition: filter 0.2s;
            background: #fff;
            display: block;
        }
        .discount {
            background: linear-gradient(90deg, #ff316a, #ffb156 85%);
            color: #fff;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 0 0 12px 12px;
            padding: 6px 0 5px 0;
            margin: 16px 0 7px 0;
            box-shadow: 0 2px 8px #ff316a24;
            letter-spacing: 2px;
            width: 80%;
            margin-left: auto;
            margin-right: auto;
            text-shadow: 0 1px 3px #0006;
        }
        .name {
            margin: 10px 0 8px 0;
            font-size: 1.08em;
            font-weight: 500;
            color: #f8f8f8;
            min-height: 48px;
            line-height: 1.2;
            text-shadow: 0 1px 3px #18181a60;
        }
        .description {
            color: #c8e6fa;
            font-size: 0.97em;
            margin: 8px 0 8px 0;
            padding: 0 4px;
            min-height: 38px;
            text-shadow: 0 1px 3px #0005;
        }
        .price {
            color: #ffb156;
            font-size: 1.16em;
            font-weight: 600;
            margin: 6px 0 8px 0;
            text-shadow: 0 1px 3px #0008;
        }
        .product a {
            color: #27e3c2;
            font-weight: bold;
            font-size: 1.04em;
            text-decoration: none;
            margin-top: 9px;
            display: inline-block;
            transition: color 0.2s;
        }
        .product a:hover {
            color: #ff316a;
            text-decoration: underline;
        }
        .loading {
            color: #aaa;
            text-align: center;
            margin: 60px 0 0 0;
            font-size: 1.3em;
        }
        /* Progress bar styles */
        #progress-container {
            width: 100%;
            max-width: 400px;
            margin: 30px auto 0 auto;
            display: none;
            background: #232538;
            border-radius: 8px;
            padding: 2px;
            box-shadow: 0 1px 8px #0004;
        }
        #progress-bar {
            height: 12px;
            background: linear-gradient(90deg,#ff316a,#27e3c2);
            width: 0%;
            border-radius: 8px;
            transition: width 0.3s;
        }
        /* Right Ribbon (Ruban Ã  droite) */
        .right-ribbon {
            position: fixed;
            top: 68px;
            right: -68px;
            z-index: 1000;
            background: linear-gradient(90deg, #ff316a, #27e3c2);
            color: #fff;
            font-weight: bold;
            font-size: 1.18em;
            padding: 16px 54px 16px 24px;
            border-radius: 14px 0 0 14px;
            box-shadow: 0 6px 22px #0006, 0 1.5px 8px #ff316a35;
            transform: rotate(28deg);
            letter-spacing: 1px;
            text-align: left;
            cursor: pointer;
            transition: right 0.2s, box-shadow 0.18s, background 0.22s;
        }
        .right-ribbon:hover {
            right: -10px;
            background: linear-gradient(90deg, #27e3c2, #ff316a);
            box-shadow: 0 10px 32px #ff316a6c, 0 8px 28px #000c;
        }
        /* Ribbon responsive */
        @media (max-width: 650px) {
            .right-ribbon {
                display: none;
            }
        }
        /* Responsive Sidebar & Main Content */
        @media (max-width: 1080px) {
            main { flex-direction: column; }
            .sidebar {
                position: static;
                height: auto;
                width: 100%;
                min-width: 0;
                border-radius: 0 0 30px 30px;
                margin: 0 0 22px 0;
                flex-direction: row;
                overflow-x: auto;
                box-shadow: 0 8px 18px #0007;
                padding: 18px 0 14px 0;
            }
            .sidebar-title {
                display: none;
            }
            .category-list {
                display: flex;
                flex-direction: row;
                overflow-x: auto;
                padding: 0 10px;
            }
            .category-item {
                margin: 0 6px 0 0;
            }
            .category-link {
                border-radius: 12px;
                border-left: none;
                border-bottom: 4px solid transparent;
                padding: 9px 22px 9px 22px;
                margin-bottom: 0;
            }
            .category-link:hover,
            .category-link.active {
                border-left: none;
                border-bottom: 4px solid #ff316a;
                background: linear-gradient(90deg,#27e3c220 0%,#ff316a11 100%);
            }
        }
        @media (max-width: 750px) {
            .products { gap: 18px; }
            .repo-section { padding: 0 2vw 36px 2vw; }
            .main-content-inner { padding: 0 2vw; }
            .sidebar { padding: 10px 0 10px 0; }
        }
        @media (max-width: 650px) {
            .products { gap: 18px; }
            .product { width: 97vw; max-width: 100vw;}
            .repo-title { font-size: 1.3em; }
            #progress-container { max-width: 98vw; }
            header { flex-direction: column; align-items: flex-start; }
            .header-content { margin-left: 0; }
        }
        /* Ajout affichage (display label) style */
        .affichage-label {
            background: #27e3c2;
            color: #12121a;
            font-size: 1.03em;
            font-weight: 700;
            padding: 6px 16px;
            border-radius: 8px;
            margin: 8px auto 18px auto;
            display: inline-block;
            box-shadow: 0 1px 8px #27e3c245;
            letter-spacing: 1px;
            text-shadow: 0 1px 3px #fff7;
        }
    </style>
</head>
<body>
    <header>
        <img src="logo.png" alt="Logo" class="logo">
        <div class="header-content">
            <div class="logo-title">IaSmarKet.us</div>
            <div class="subtitle">
                IaSmarKet.us is an invitation to take advantage of great discounts and promotions!<br>
                Shop smart and seize the hottest deals now.
            </div>
        </div>
    </header>
    <main>
        <nav class="sidebar" id="sidebar-menu">
            <div class="sidebar-title">Categories</div>
            <ul class="category-list" id="category-list"></ul>
        </nav>
        <div class="main-content">
            <div class="main-content-inner">
                <h1>Top 10 Products with the Highest Discounts by Category</h1>
                <div id="progress-container">
                    <div id="progress-bar"></div>
                </div>
                <div id="results"></div>
                <div class="loading" id="loading">Loading data, please wait...</div>
            </div>
        </div>
    </main>
    <!-- Ruban Ã  droite -->
    <div class="right-ribbon" onclick="window.open('https://iasmarket.github.io/extradeals/', '_blank')">
        ð Extra Deals!
    </div>
    <script>
    // List of category repositories
    const repositories = [
        { name: "Computers", url: "https://iasmarket.github.io/Computers/" },
        { name: "Automotive", url: "https://iasmarket.github.io/Automotive/" },
        { name: "Industrial", url: "https://iasmarket.github.io/Industrial/" },
        { name: "Garden & Outdoor", url: "https://iasmarket.github.io/GardenAndOutdoor/" },
        { name: "Office Products", url: "https://iasmarket.github.io/OfficeProducts/" },
        { name: "Appliances", url: "https://iasmarket.github.io/Appliances/" },
        { name: "Arts & Crafts", url: "https://iasmarket.github.io/ArtsAndCrafts/" },
        { name: "Fashion Boys", url: "https://iasmarket.github.io/FashionBoys/" },
        { name: "Beauty", url: "https://iasmarket.github.io/Beauty/" },
        { name: "Pantry", url: "https://iasmarket.github.io/Pantry/" },
        { name: "Extra Deals", url: "https://iasmarket.github.io/extradeals/" },
        { name: "Video Games", url: "https://iasmarket.github.io/VideoGames/" },
        { name: "Pet Supplies", url: "https://iasmarket.github.io/PetSupplies/" },
        { name: "Gift Cards", url: "https://iasmarket.github.io/GiftCards/" },
        { name: "Luggage", url: "https://iasmarket.github.io/Luggage/" },
        { name: "Baby", url: "https://iasmarket.github.io/Baby/" },
        { name: "Grocery & Gourmet Food", url: "https://iasmarket.github.io/GroceryAndGourmetFood/" },
        { name: "Software", url: "https://iasmarket.github.io/Software/" },
        { name: "Electronics", url: "https://iasmarket.github.io/Electronics/" },
        { name: "Home & Kitchen", url: "https://iasmarket.github.io/HomeAndKitchen/" },
        { name: "Fashion Men", url: "https://iasmarket.github.io/FashionMen/" },
        { name: "Books", url: "https://iasmarket.github.io/Books/" },
        { name: "Fashion Baby", url: "https://iasmarket.github.io/FashionBaby/" },
        { name: "Health Personal Care", url: "https://iasmarket.github.io/HealthPersonalCare/" },
        { name: "Jewelry", url: "https://iasmarket.github.io/Jewelry/" },
        { name: "Books Computers", url: "https://iasmarket.github.io/BooksComputers/" }
    ];

    // Sidebar menu rendering
    const categoryList = document.getElementById('category-list');
    repositories.forEach((repo, idx) => {
        const li = document.createElement('li');
        li.className = 'category-item';
        const a = document.createElement('a');
        a.className = 'category-link';
        a.href = '#cat-' + idx;
        a.textContent = repo.name;
        a.dataset.catidx = idx;
        li.appendChild(a);
        categoryList.appendChild(li);
    });

    // To avoid duplicates (by link or image)
    const seenProducts = new Set();

    // Helper to get the 1st <p> as name, 2nd as description if available
    function extractNameAndDescription(el) {
        const ps = el.querySelectorAll('p');
        let name = "";
        let description = "";
        if (ps.length === 1) {
            name = ps[0].textContent.trim();
        } else if (ps.length >= 2) {
            name = ps[0].textContent.trim();
            // Try to find a <p> that is not the discount or price
            for (let i = 1; i < ps.length; i++) {
                const txt = ps[i].textContent.trim();
                if (!/% *0FF/i.test(txt) && !/^\$\d/.test(txt)) {
                    description = txt;
                    break;
                }
            }
        }
        return { name, description };
    }

    async function fetchAndParseProducts(repo) {
        try {
            const res = await fetch(repo.url);
            const html = await res.text();
            const div = document.createElement('div');
            div.innerHTML = html;
            const products = [...div.querySelectorAll('.product')];
            const productObjs = products.map(el => {
                const img = el.querySelector('img');
                // Detect name/description
                let { name, description } = extractNameAndDescription(el);
                if (!name) name = img?.alt?.trim() || "Product";
                // Link, image
                const link = el.querySelector('a')?.href || '';
                const image = img?.src || '';
                // Discount
                const discountText = Array.from(el.querySelectorAll('p')).map(p => p.textContent).find(t => /% *0FF/i.test(t));
                const discountMatch = discountText?.match(/-?(\d+)% *0FF/i);
                const discount = discountMatch ? parseInt(discountMatch[1], 10) : 0;
                // Price
                const priceText = Array.from(el.querySelectorAll('p')).map(p => p.textContent).find(t => /\$\d/.test(t));
                const price = priceText || '';
                return { name, description, link, image, discount, price };
            })
            .filter(p => p.discount > 0 && (p.link || p.image));
            productObjs.sort((a, b) => b.discount - a.discount);
            // Take the first 3 unique products (no duplicate image or link)
            const unique = [];
            for (let prod of productObjs) {
                const key = (prod.link || '') + '|' + (prod.image || '');
                if (!seenProducts.has(key)) {
                    seenProducts.add(key);
                    unique.push(prod);
                }
                if (unique.length >= 10) break;
            }
            return unique;
        } catch (e) {
            return [];
        }
    }

    async function main() {
        const resultsDiv = document.getElementById('results');
        const progressContainer = document.getElementById('progress-container');
        const progressBar = document.getElementById('progress-bar');
        progressContainer.style.display = 'block';
        let html = '';
        // Ajout affichage: label d'affichage en haut
        
        for (let i = 0; i < repositories.length; i++) {
            const repo = repositories[i];
            const products = await fetchAndParseProducts(repo);
            if (!products.length) continue;
            html += `<div class="repo-section" id="cat-${i}">
                <a class="repo-title" href="${repo.url}" target="_blank">${repo.name}</a>
                <div class="products">`;
            products.forEach(product => {
                html += `<div class="product">
                    <a href="${product.link}" target="_blank"><img src="${product.image}" alt="${product.name}"></a>
                    <div class="discount">-${product.discount}% OFF</div>
                    <div class="name">${product.name}</div>
                    <div class="description">${product.description || ''}</div>
                    <div class="price">${product.price}</div>
                    <a href="${product.link}" target="_blank">View product</a>
                </div>`;
            });
            html += `</div></div>`;
            // Mise Ã  jour de la barre de progression
            progressBar.style.width = Math.round((i + 1) / repositories.length * 100) + '%';
        }
        progressContainer.style.display = 'none';
        resultsDiv.innerHTML = html || '<div style="color:red;text-align:center;">No products found.</div>';
        document.getElementById('loading').style.display = 'none';
    }

    // Highlight sidebar category when scrolling to its section
    function setupSidebarScrollHighlight() {
        const sectionEls = Array.from(document.querySelectorAll('.repo-section'));
        const linkEls = Array.from(document.querySelectorAll('.category-link'));
        function onScroll() {
            let idxToActivate = 0;
            for (let i = 0; i < sectionEls.length; i++) {
                const rect = sectionEls[i].getBoundingClientRect();
                if (rect.top < 120) {
                    idxToActivate = i;
                }
            }
            linkEls.forEach((a, idx) => {
                if (idx === idxToActivate) {
                    a.classList.add('active');
                } else {
                    a.classList.remove('active');
                }
            });
        }
        window.addEventListener('scroll', onScroll, { passive: true });
        // On click, highlight manually
        linkEls.forEach(a => {
            a.addEventListener('click', () => {
                linkEls.forEach(x => x.classList.remove('active'));
                a.classList.add('active');
            });
        });
    }

    main().then(() => {
        setupSidebarScrollHighlight();
    });
    </script>
</body>
</html>
